import{J as i,j as e,B as h,T,a as o,Z as _,Y as Q,X as w,a5 as ee,l as te,$ as A,a4 as K}from"./index-CpGWNxNa.js";import{a as se,b as ae,A as ne,d as L,I as P,F as z}from"./request-helpers-D0O3LUco.js";import{M as ie,b as re,I as oe,E as le,c as ce,F as M,A as q,a as F}from"./MenuActionUpdate-ZUpRltUB.js";import{T as de}from"./TableBodyReferensiPenggunaSkeleton-_n7aQFnH.js";import{B as I}from"./Button-DrUDL9uD.js";import{I as me,S as ue}from"./arsitektur-bisnis-Bgs8Rp8F.js";import{T as xe,a as pe,b as ge,c as he,d as fe}from"./TablePagination-DdxZtwmT.js";import{a as O,T as u}from"./TableRow-CrAhGf4e.js";import{T as $}from"./DashboardAdminLayout-CN4Vh8VJ.js";function je({dataReferensi:x}){const[p,j]=i.useState(null),[l,g]=i.useState({selected:{},count:{},listSelectedKey:{}}),[y,R]=i.useState({id:0,nama:"",kode:0}),[r,c]=i.useState({slicedDataRef:null,currentPage:0}),[m,E]=i.useState({}),[G,C]=i.useState(!1),[b,D]=i.useState({create:null,update:null}),Y={create:!!b.create,update:!!b.update},[N,k]=i.useState(""),[v,S]=i.useState({}),H=s=>()=>{g(a=>({...a,selected:{...a.selected,[s]:!a.selected[s]}}))},X=(s,a)=>n=>{E(t=>({...t,[s]:n.target.checked})),g(t=>{const f=t.count[a]??0,B=t.listSelectedKey[a]??[];return n.target.checked||B.pop(),{...t,count:{...t.count,[a]:n.target.checked?f+1:f-1},listSelectedKey:{...t.listSelectedKey,[a]:n.target.checked?[...B,Number(n.target.value)]:[...B]}}})},W=s=>a=>{D(n=>({...n,update:a.currentTarget})),R({id:s.id,nama:s.nama,kode:s.kode})},U=(s,a)=>{a!=="clickaway"&&k("")},J=(s,a)=>async()=>{S(t=>({...t,[a]:!0}));const n=await z("https://spbe-malkot.onrender.com/api/v1/refrensi_pengguna/"+s,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+A.get("authToken")}});if(!n.success)return S(t=>({...t,[a]:!1})),k("Gagal menghapus data");S(t=>({...t,[a]:!1})),k(n.data),C(t=>!t)},V=s=>async()=>{S(t=>({...t,[s]:!0}));const a=l.listSelectedKey[s]??[];if(a.length===0)return S(t=>({...t,[s]:!1})),k("Pilih data terlebih dulu");const n=[];a.forEach(t=>{const f=z("https://spbe-malkot.onrender.com/api/v1/refrensi_pengguna/"+t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+A.get("authToken")}});n.push(f)});try{return await Promise.all(n),g(t=>({...t,count:{...t.count,[s]:0},listSelectedKey:{...t.listSelectedKey,[s]:[]}})),k("Data berhasil dihapus"),S(t=>({...t,[s]:!1})),C(t=>!t)}catch(t){if(S(f=>({...f,[s]:!1})),t instanceof Error)return k(t.message)}},Z=(s,a)=>{const n=(a+1-1)*5,t=n+5;c({slicedDataRef:s.slice(n,t),currentPage:a})};i.useEffect(()=>{(async a=>{const n=await z("https://spbe-malkot.onrender.com/api/v1/refrensi_detail/"+a+"/pengguna",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+A.get("authToken")}});console.log(n.data.Refrensi_Pengguna);const t=n.data.Refrensi_Pengguna;c(f=>({...f,slicedDataRef:t.slice(0,5)})),j(t)})(x.detailReferensi.id)},[G]);const d=`${x.detailReferensi.nama}#${x.detailReferensi.kode}`;return e.jsxs(h,{sx:{marginLeft:"9em",marginTop:"1em"},children:[e.jsxs(h,{component:"div",className:"table-filtering-panel",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.5em",marginBottom:"1em"},children:[e.jsxs(h,{sx:{display:"flex",gap:"1em"},children:[e.jsx(I,{variant:l.selected[d]?"contained":"text",size:"small",sx:{textTransform:"none"},onClick:H(d),color:l.selected[d]?"error":void 0,children:l.selected[d]?"Cancel":"Select items"}),l.selected[d]&&e.jsxs(h,{children:[e.jsx(T,{variant:"caption",sx:{marginX:"1em",fontWeight:"normal",cursor:"not-allowed",color:o[700]},children:`${l.count[d]??0} Selected`}),e.jsx(I,{color:"error",sx:{textTransform:"none"},disabled:v[d],onClick:V(d),children:v[d]?e.jsx(_,{size:20,sx:{color:"red"}}):"Delete"})]})]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:"0em 0.5em"},children:[e.jsx(Q,{type:"text",name:"search",placeholder:"Search...",size:"small",autoComplete:"off",InputProps:{startAdornment:e.jsx(me,{position:"start",children:e.jsx(se,{fontSize:"small"})}),sx:{fontSize:"0.6em","& .MuiInputBase-input::placeholder":{fontSize:"1.25em"}}},sx:{minWidth:"16em"}}),e.jsx(I,{variant:"outlined",size:"small",color:"secondary",startIcon:e.jsx(ae,{fontSize:"small"}),sx:{textTransform:"none"},children:"Search by"}),e.jsx(I,{variant:"contained",startIcon:e.jsx(ne,{fontSize:"small"}),size:"small",sx:{textTransform:"none"},onClick:s=>{D(a=>({...a,create:s.currentTarget}))},children:"New"})]})]}),e.jsx(ue,{anchorOrigin:{horizontal:"left",vertical:"bottom"},open:!!N,message:N,autoHideDuration:1500,onClose:U}),b.create&&e.jsx(ie,{dataReferensi:{...x},anchorEl:b.create,setAnchorEl:D,menuOpen:Y.create,setDataAction:C}),b.update&&e.jsx(re,{dataReferensi:{...x},detailReferensiItem:y,anchorEl:b.update,setAnchorEl:D,menuOpen:Y.update,setDataAction:C}),e.jsxs(xe,{sx:{border:"1px solid "+o[300],borderRadius:"0.3em"},children:[e.jsxs(pe,{children:[e.jsx(ge,{children:e.jsxs(O,{children:[e.jsx(u,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:o[300]},children:e.jsx(T,{variant:"subtitle2",sx:{color:o[700]},children:l.selected[d]?"":"NO"})}),e.jsx(u,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:o[300]},children:e.jsx(T,{variant:"subtitle2",sx:{color:o[700]},children:"NAME"})}),e.jsx(u,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:o[300]},children:e.jsx(T,{variant:"subtitle2",sx:{color:o[700]},children:"KODE"})}),e.jsx(u,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:o[300]},children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:"0em 0.3em"},children:[e.jsx(T,{variant:"subtitle2",sx:{color:o[700]},children:"LEVEL"}),e.jsx(w,{size:"small",children:e.jsx(oe,{fontSize:"small"})})]})}),e.jsx(u,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:o[300]},children:e.jsx(T,{variant:"subtitle2",sx:{color:o[700]},children:"ACTION"})})]})}),e.jsx(he,{children:r.slicedDataRef?r.slicedDataRef.length>0?r.slicedDataRef.map((s,a)=>{const n=`${s.nama}#${a}`;return e.jsxs(O,{sx:{"&:hover":{backgroundColor:o[200]}},children:[e.jsx(u,{sx:{paddingY:"0.7em"},children:l.selected[d]?e.jsx(ee,{size:"small",checked:m[n]??!1,value:s.id,onChange:X(n,d),sx:{padding:0}}):r.currentPage*5+(a+1)}),e.jsx(u,{sx:{paddingY:"0.7em"},children:s.nama}),e.jsx(u,{sx:{paddingY:"0.7em"},children:s.kode}),e.jsx(u,{sx:{paddingY:"0.7em"},children:"level tidak tersedia di API"}),e.jsx(u,{sx:{paddingY:"0.7em"},children:e.jsxs(h,{sx:{display:"flex"},children:[e.jsx($,{title:"Ubah data",placement:"left-start",children:e.jsx(w,{size:"small",sx:{padding:"0.3em"},onClick:W({id:s.id,nama:s.nama,kode:s.kode}),children:e.jsx(le,{fontSize:"small",sx:{color:te[700]}})})}),e.jsx($,{title:"Delete",placement:"right-start",children:e.jsx(w,{size:"small",sx:{padding:"0.3em"},disabled:v[n],onClick:J(s.id,n),children:v[n]?e.jsx(_,{size:20,sx:{color:o[600]}}):e.jsx(ce,{fontSize:"small"})})})]})})]},a)}):e.jsx(O,{children:e.jsx(u,{size:"small",children:e.jsx(L,{severity:"warning",icon:e.jsx(P,{fontSize:"small",sx:{color:o[700]}}),sx:{fontSize:"small",backgroundColor:"transparent",fontWeight:550,fontStyle:"italic"},children:"No records found"})})}):e.jsx(de,{})})]}),e.jsx(fe,{component:"div",count:p?p.length:0,onPageChange:(s,a)=>{Z(p,a)},page:r?r.currentPage:0,rowsPerPage:5,rowsPerPageOptions:[5,10]})]})]})}function Se({indukReferensi:x,subReferensi:p,collapseFolder:j,collapseHandler:l}){const[g,y]=i.useState(null),[R,r]=i.useState(!1);return i.useEffect(()=>{(async m=>{const E=await z("https://spbe-malkot.onrender.com/api/v1/sub_refrensi/"+m+"/detail",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+A.get("authToken")}});y(E.data.Detail_Refrensi)})(p.id)},[R]),g?g.length>0?g.map((c,m)=>{const E=`${c.nama}#${c.kode}`;return e.jsxs(h,{children:[e.jsx(M,{folderLevel:"3",folderSxProps:{marginLeft:"6em",marginBottom:m===g.length-1?void 0:"0.5em",marginTop:m===0?void 0:"0.5em"},kodeReferensiArsitektur:"RAA.0"+c.kode,collapseState:j,collapseHandler:l,setDataAction:r,dataRef:c}),e.jsx(K,{in:j[E],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-lvl3-container",children:e.jsx(je,{dataReferensi:{indukReferensi:x,subReferensi:p,detailReferensi:c}})})]},m)}):e.jsxs(L,{severity:"warning",icon:e.jsx(P,{fontSize:"small"}),sx:{marginX:"6em",marginY:"0.5em",fontSize:"small"},children:[e.jsx(q,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx(F,{sxProps:{marginLeft:"6em"}})}function De({indukReferensi:x,collapseFolder:p,collapseHandler:j}){const[l,g]=i.useState(null),[y,R]=i.useState(!1);return i.useEffect(()=>{(async c=>{const m=await z("https://spbe-malkot.onrender.com/api/v1/induk_refrensi/"+c+"/sub",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+A.get("authToken")}});g(m.data.Sub_Refrensi)})(x.id)},[y]),l?l.length>0?l.map((r,c)=>{const m=`${r.nama}#${r.kode}`;return e.jsxs(h,{children:[e.jsx(M,{folderLevel:"2",folderSxProps:{marginLeft:"3em",marginY:"0.5em"},kodeReferensiArsitektur:"RAA.0"+r.kode,collapseState:p,collapseHandler:j,setDataAction:R,dataRef:r}),e.jsx(K,{in:p[m],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-container",children:e.jsx(Se,{indukReferensi:x,subReferensi:r,collapseFolder:p,collapseHandler:j})})]},c)}):e.jsxs(L,{severity:"warning",icon:e.jsx(P,{fontSize:"small"}),sx:{marginX:"3em",marginY:"0.5em",fontSize:"small"},children:[e.jsx(q,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx(F,{sxProps:{marginLeft:"3em",marginTop:"0.5em"}})}export{De as S};
