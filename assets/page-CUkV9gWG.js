import{J as r,j as e,B as x,T,a as m,Z as M,Y as ee,X as L,a5 as te,l as ne,$ as E,a4 as Y}from"./index-DyErgHkj.js";import{T as G,a as se}from"./DashboardAdminLayout-BIdVf92w.js";import{a as ae,b as ie,A as H,d as B,I as w,F as A}from"./request-helpers-BQxCq-ex.js";import{M as re,b as oe,I as le,E as ce,c as de,F as P,A as _,a as $,D as me}from"./MenuActionUpdate-BgYrPJlc.js";import{T as ue}from"./TableBodyReferensiPenggunaSkeleton-Zv5b6-5r.js";import{B as C}from"./Button-BwFa39Ev.js";import{I as xe,S as pe}from"./arsitektur-bisnis-BR1u1c-0.js";import{T as he,a as ge,b as fe,c as je,d as Se}from"./TablePagination-CzqDPl5F.js";import{a as N,T as j}from"./TableRow-CNuvr_lu.js";import"./Skeleton-D3WzhggV.js";import"./dividerClasses-5Yj2gWGd.js";import"./useThemeProps-BLsYwCNi.js";function ke({dataReferensi:l}){const[u,f]=r.useState(null),[c,p]=r.useState({selected:{},count:{},listSelectedKey:{}}),[S,b]=r.useState({id:0,nama:"",kode:0}),[o,d]=r.useState({slicedDataRef:null,currentPage:0}),[i,h]=r.useState({}),[O,D]=r.useState(!1),[R,v]=r.useState({create:null,update:null}),F={create:!!R.create,update:!!R.update},[q,z]=r.useState(""),[I,y]=r.useState({}),X=n=>()=>{p(s=>({...s,selected:{...s.selected,[n]:!s.selected[n]}}))},W=(n,s)=>a=>{h(t=>({...t,[n]:a.target.checked})),p(t=>{const k=t.count[s]??0,K=t.listSelectedKey[s]??[];return a.target.checked||K.pop(),{...t,count:{...t.count,[s]:a.target.checked?k+1:k-1},listSelectedKey:{...t.listSelectedKey,[s]:a.target.checked?[...K,Number(a.target.value)]:[...K]}}})},U=n=>s=>{v(a=>({...a,update:s.currentTarget})),b({id:n.id,nama:n.nama,kode:n.kode})},J=(n,s)=>{s!=="clickaway"&&z("")},V=(n,s)=>async()=>{y(t=>({...t,[s]:!0}));const a=await A("https://spbe-malkot.onrender.com/api/v1/refrensi_pengguna/"+n,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});if(!a.success)return y(t=>({...t,[s]:!1})),z("Gagal menghapus data");y(t=>({...t,[s]:!1})),z(a.data),D(t=>!t)},Z=n=>async()=>{y(t=>({...t,[n]:!0}));const s=c.listSelectedKey[n]??[];if(s.length===0)return y(t=>({...t,[n]:!1})),z("Pilih data terlebih dulu");const a=[];s.forEach(t=>{const k=A("https://spbe-malkot.onrender.com/api/v1/refrensi_pengguna/"+t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});a.push(k)});try{return await Promise.all(a),p(t=>({...t,count:{...t.count,[n]:0},listSelectedKey:{...t.listSelectedKey,[n]:[]}})),z("Data berhasil dihapus"),y(t=>({...t,[n]:!1})),D(t=>!t)}catch(t){if(y(k=>({...k,[n]:!1})),t instanceof Error)return z(t.message)}},Q=(n,s)=>{const a=(s+1-1)*5,t=a+5;d({slicedDataRef:n.slice(a,t),currentPage:s})};r.useEffect(()=>{(async s=>{const a=await A("https://spbe-malkot.onrender.com/api/v1/refrensi_detail/"+s+"/pengguna",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});console.log(a.data.Refrensi_Pengguna);const t=a.data.Refrensi_Pengguna;d(k=>({...k,slicedDataRef:t.slice(0,5)})),f(t)})(l.detailReferensi.id)},[O]);const g=`${l.detailReferensi.nama}#${l.detailReferensi.kode}`;return e.jsxs(x,{sx:{marginLeft:"9em",marginTop:"1em"},children:[e.jsxs(x,{component:"div",className:"table-filtering-panel",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.5em",marginBottom:"1em"},children:[e.jsxs(x,{sx:{display:"flex",gap:"1em"},children:[e.jsx(C,{variant:c.selected[g]?"contained":"text",size:"small",sx:{textTransform:"none"},onClick:X(g),color:c.selected[g]?"error":void 0,children:c.selected[g]?"Cancel":"Select items"}),c.selected[g]&&e.jsxs(x,{children:[e.jsx(T,{variant:"caption",sx:{marginX:"1em",fontWeight:"normal",cursor:"not-allowed",color:m[700]},children:`${c.count[g]??0} Selected`}),e.jsx(C,{color:"error",sx:{textTransform:"none"},disabled:I[g],onClick:Z(g),children:I[g]?e.jsx(M,{size:20,sx:{color:"red"}}):"Delete"})]})]}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:"0em 0.5em"},children:[e.jsx(ee,{type:"text",name:"search",placeholder:"Search...",size:"small",autoComplete:"off",InputProps:{startAdornment:e.jsx(xe,{position:"start",children:e.jsx(ae,{fontSize:"small"})}),sx:{fontSize:"0.6em","& .MuiInputBase-input::placeholder":{fontSize:"1.25em"}}},sx:{minWidth:"16em"}}),e.jsx(C,{variant:"outlined",size:"small",color:"secondary",startIcon:e.jsx(ie,{fontSize:"small"}),sx:{textTransform:"none"},children:"Search by"}),e.jsx(C,{variant:"contained",startIcon:e.jsx(H,{fontSize:"small"}),size:"small",sx:{textTransform:"none"},onClick:n=>{v(s=>({...s,create:n.currentTarget}))},children:"New"})]})]}),e.jsx(pe,{anchorOrigin:{horizontal:"left",vertical:"bottom"},open:!!q,message:q,autoHideDuration:1500,onClose:J}),R.create&&e.jsx(re,{dataReferensi:{...l},anchorEl:R.create,setAnchorEl:v,menuOpen:F.create,setDataAction:D}),R.update&&e.jsx(oe,{dataReferensi:{...l},detailReferensiItem:S,anchorEl:R.update,setAnchorEl:v,menuOpen:F.update,setDataAction:D}),e.jsxs(he,{sx:{border:"1px solid "+m[300],borderRadius:"0.3em"},children:[e.jsxs(ge,{children:[e.jsx(fe,{children:e.jsxs(N,{children:[e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:m[300]},children:e.jsx(T,{variant:"subtitle2",sx:{color:m[700]},children:c.selected[g]?"":"NO"})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:m[300]},children:e.jsx(T,{variant:"subtitle2",sx:{color:m[700]},children:"NAME"})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:m[300]},children:e.jsx(T,{variant:"subtitle2",sx:{color:m[700]},children:"KODE"})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:m[300]},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:"0em 0.3em"},children:[e.jsx(T,{variant:"subtitle2",sx:{color:m[700]},children:"LEVEL"}),e.jsx(L,{size:"small",children:e.jsx(le,{fontSize:"small"})})]})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:m[300]},children:e.jsx(T,{variant:"subtitle2",sx:{color:m[700]},children:"ACTION"})})]})}),e.jsx(je,{children:o.slicedDataRef?o.slicedDataRef.length>0?o.slicedDataRef.map((n,s)=>{const a=`${n.nama}#${s}`;return e.jsxs(N,{sx:{"&:hover":{backgroundColor:m[200]}},children:[e.jsx(j,{sx:{paddingY:"0.7em"},children:c.selected[g]?e.jsx(te,{size:"small",checked:i[a]??!1,value:n.id,onChange:W(a,g),sx:{padding:0}}):o.currentPage*5+(s+1)}),e.jsx(j,{sx:{paddingY:"0.7em"},children:n.nama}),e.jsx(j,{sx:{paddingY:"0.7em"},children:n.kode}),e.jsx(j,{sx:{paddingY:"0.7em"},children:"level tidak tersedia di API"}),e.jsx(j,{sx:{paddingY:"0.7em"},children:e.jsxs(x,{sx:{display:"flex"},children:[e.jsx(G,{title:"Ubah data",placement:"left-start",children:e.jsx(L,{size:"small",sx:{padding:"0.3em"},onClick:U({id:n.id,nama:n.nama,kode:n.kode}),children:e.jsx(ce,{fontSize:"small",sx:{color:ne[700]}})})}),e.jsx(G,{title:"Delete",placement:"right-start",children:e.jsx(L,{size:"small",sx:{padding:"0.3em"},disabled:I[a],onClick:V(n.id,a),children:I[a]?e.jsx(M,{size:20,sx:{color:m[600]}}):e.jsx(de,{fontSize:"small"})})})]})})]},s)}):e.jsx(N,{children:e.jsx(j,{size:"small",children:e.jsx(B,{severity:"warning",icon:e.jsx(w,{fontSize:"small",sx:{color:m[700]}}),sx:{fontSize:"small",backgroundColor:"transparent",fontWeight:550,fontStyle:"italic"},children:"No records found"})})}):e.jsx(ue,{})})]}),e.jsx(Se,{component:"div",count:u?u.length:0,onPageChange:(n,s)=>{Q(u,s)},page:o?o.currentPage:0,rowsPerPage:5,rowsPerPageOptions:[5,10]})]})]})}function be({indukReferensi:l,subReferensi:u,collapseFolder:f,collapseHandler:c}){const[p,S]=r.useState(null),[b,o]=r.useState(!1);return r.useEffect(()=>{(async i=>{const h=await A("https://spbe-malkot.onrender.com/api/v1/sub_refrensi/"+i+"/detail",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});S(h.data.Detail_Refrensi)})(u.id)},[b]),p?p.length>0?p.map((d,i)=>{const h=`${d.nama}#${d.kode}`;return e.jsxs(x,{children:[e.jsx(P,{folderLevel:"3",folderSxProps:{marginLeft:"6em",marginBottom:i===p.length-1?void 0:"0.5em",marginTop:i===0?void 0:"0.5em"},kodeReferensiArsitektur:"RAK.0"+l.kode+".0"+u.kode+".0"+d.kode,collapseState:f,collapseHandler:c,setDataAction:o,dataRef:d}),e.jsx(Y,{in:f[h],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-lvl3-container",children:e.jsx(ke,{dataReferensi:{indukReferensi:l,subReferensi:u,detailReferensi:d}})})]},i)}):e.jsxs(B,{severity:"warning",icon:e.jsx(w,{fontSize:"small"}),sx:{marginX:"6em",marginY:"0.5em",fontSize:"small"},children:[e.jsx(_,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx($,{sxProps:{marginLeft:"6em"}})}function ye({indukReferensi:l,collapseFolder:u,collapseHandler:f}){const[c,p]=r.useState(null),[S,b]=r.useState(!1);return r.useEffect(()=>{(async d=>{const i=await A("https://spbe-malkot.onrender.com/api/v1/induk_refrensi/"+d+"/sub",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});p(i.data.Sub_Refrensi)})(l.id)},[S]),c?c.length>0?c.map((o,d)=>{const i=`${o.nama}#${o.kode}`;return e.jsxs(x,{children:[e.jsx(P,{folderLevel:"2",folderSxProps:{marginLeft:"3em",marginY:"0.5em"},kodeReferensiArsitektur:"RAK.0"+l.kode+".0"+o.kode,collapseState:u,collapseHandler:f,setDataAction:b,dataRef:o}),e.jsx(Y,{in:u[i],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-container",children:e.jsx(be,{indukReferensi:l,subReferensi:o,collapseFolder:u,collapseHandler:f})})]},d)}):e.jsxs(B,{severity:"warning",icon:e.jsx(w,{fontSize:"small"}),sx:{marginX:"3em",marginY:"0.5em",fontSize:"small"},children:[e.jsx(_,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx($,{sxProps:{marginLeft:"3em",marginTop:"0.5em"}})}function Ke(){const[l,u]=r.useState(null),[f,c]=r.useState({}),[p,S]=r.useState(!1),[b,o]=r.useState(!1),d=i=>()=>{c(h=>({...h,[i]:!h[i]}))};return r.useEffect(()=>{(async()=>{const h=await A("https://spbe-malkot.onrender.com/api/v1/refrensi_arsitektur/6/induk",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});u(h.data.Induk_Refrensi)})()},[p]),e.jsx(se,{children:e.jsxs(x,{component:"div",className:"content-container",sx:{padding:"0.5em"},children:[e.jsxs(x,{component:"div",className:"referensi-arsitektur-layanan-container",children:[e.jsxs(x,{component:"div",className:"referensi-arsitektur-layanan-header",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingY:"0.5em"},children:[e.jsx(T,{variant:"subtitle2",sx:{fontSize:"1em",color:m[800]},children:"Referensi Arsitektur Keamanan"}),e.jsx(C,{variant:"contained",startIcon:e.jsx(H,{sx:{fontSize:"small",color:"white"}}),size:"small",sx:{textTransform:"none"},onClick:()=>o(!0),children:"Level 1"})]}),l?l.length>0?l.map((i,h)=>{const O=`${i.nama}#${i.kode}`;return e.jsxs(x,{children:[e.jsx(P,{folderLevel:"1",kodeReferensiArsitektur:"RAK.0"+i.kode,collapseState:f,collapseHandler:d,dataRef:i,setDataAction:S}),e.jsx(Y,{in:f[O],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-container",children:e.jsx(ye,{collapseFolder:f,collapseHandler:d,indukReferensi:i})})]},h)}):e.jsxs(B,{severity:"warning",icon:e.jsx(w,{fontSize:"small"}),sx:{marginX:"3em",marginY:"0.5em",fontSize:"small"},children:[e.jsx(_,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx($,{})]}),e.jsx(me,{referensiArsitekturId:6,openDialog:b,setOpenDialog:o,setDataAction:S})]})})}export{Ke as default};
