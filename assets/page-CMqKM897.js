import{J as r,j as e,B as u,T as R,a as d,Z as M,Y as ee,X as L,a5 as te,l as se,$ as z,a4 as P}from"./index-CpGWNxNa.js";import{T as G,a as ne}from"./DashboardAdminLayout-CN4Vh8VJ.js";import{a as ae,b as ie,A as H,d as B,I as w,F as E}from"./request-helpers-D0O3LUco.js";import{M as re,b as oe,I as le,E as ce,c as de,F as _,A as $,a as K,D as me}from"./MenuActionUpdate-ZUpRltUB.js";import{T as ue}from"./TableBodyReferensiPenggunaSkeleton-_n7aQFnH.js";import{B as A}from"./Button-DrUDL9uD.js";import{I as xe,S as pe}from"./arsitektur-bisnis-Bgs8Rp8F.js";import{T as he,a as ge,b as fe,c as je,d as Se}from"./TablePagination-DdxZtwmT.js";import{a as Y,T as j}from"./TableRow-CrAhGf4e.js";import"./Skeleton-FVbYjgpo.js";import"./dividerClasses-e0dSckBO.js";import"./useThemeProps-DBl1f4Ct.js";function ke({dataReferensi:m}){const[x,f]=r.useState(null),[l,p]=r.useState({selected:{},count:{},listSelectedKey:{}}),[S,b]=r.useState({id:0,nama:"",kode:0}),[o,c]=r.useState({slicedDataRef:null,currentPage:0}),[i,h]=r.useState({}),[O,C]=r.useState(!1),[T,v]=r.useState({create:null,update:null}),F={create:!!T.create,update:!!T.update},[q,D]=r.useState(""),[I,y]=r.useState({}),X=s=>()=>{p(n=>({...n,selected:{...n.selected,[s]:!n.selected[s]}}))},W=(s,n)=>a=>{h(t=>({...t,[s]:a.target.checked})),p(t=>{const k=t.count[n]??0,N=t.listSelectedKey[n]??[];return a.target.checked||N.pop(),{...t,count:{...t.count,[n]:a.target.checked?k+1:k-1},listSelectedKey:{...t.listSelectedKey,[n]:a.target.checked?[...N,Number(a.target.value)]:[...N]}}})},U=s=>n=>{v(a=>({...a,update:n.currentTarget})),b({id:s.id,nama:s.nama,kode:s.kode})},J=(s,n)=>{n!=="clickaway"&&D("")},V=(s,n)=>async()=>{y(t=>({...t,[n]:!0}));const a=await E("https://spbe-malkot.onrender.com/api/v1/refrensi_pengguna/"+s,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+z.get("authToken")}});if(!a.success)return y(t=>({...t,[n]:!1})),D("Gagal menghapus data");y(t=>({...t,[n]:!1})),D(a.data),C(t=>!t)},Z=s=>async()=>{y(t=>({...t,[s]:!0}));const n=l.listSelectedKey[s]??[];if(n.length===0)return y(t=>({...t,[s]:!1})),D("Pilih data terlebih dulu");const a=[];n.forEach(t=>{const k=E("https://spbe-malkot.onrender.com/api/v1/refrensi_pengguna/"+t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+z.get("authToken")}});a.push(k)});try{return await Promise.all(a),p(t=>({...t,count:{...t.count,[s]:0},listSelectedKey:{...t.listSelectedKey,[s]:[]}})),D("Data berhasil dihapus"),y(t=>({...t,[s]:!1})),C(t=>!t)}catch(t){if(y(k=>({...k,[s]:!1})),t instanceof Error)return D(t.message)}},Q=(s,n)=>{const a=(n+1-1)*5,t=a+5;c({slicedDataRef:s.slice(a,t),currentPage:n})};r.useEffect(()=>{(async n=>{const a=await E("https://spbe-malkot.onrender.com/api/v1/refrensi_detail/"+n+"/pengguna",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+z.get("authToken")}});console.log(a.data.Refrensi_Pengguna);const t=a.data.Refrensi_Pengguna;c(k=>({...k,slicedDataRef:t.slice(0,5)})),f(t)})(m.detailReferensi.id)},[O]);const g=`${m.detailReferensi.nama}#${m.detailReferensi.kode}`;return e.jsxs(u,{sx:{marginLeft:"9em",marginTop:"1em"},children:[e.jsxs(u,{component:"div",className:"table-filtering-panel",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.5em",marginBottom:"1em"},children:[e.jsxs(u,{sx:{display:"flex",gap:"1em"},children:[e.jsx(A,{variant:l.selected[g]?"contained":"text",size:"small",sx:{textTransform:"none"},onClick:X(g),color:l.selected[g]?"error":void 0,children:l.selected[g]?"Cancel":"Select items"}),l.selected[g]&&e.jsxs(u,{children:[e.jsx(R,{variant:"caption",sx:{marginX:"1em",fontWeight:"normal",cursor:"not-allowed",color:d[700]},children:`${l.count[g]??0} Selected`}),e.jsx(A,{color:"error",sx:{textTransform:"none"},disabled:I[g],onClick:Z(g),children:I[g]?e.jsx(M,{size:20,sx:{color:"red"}}):"Delete"})]})]}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:"0em 0.5em"},children:[e.jsx(ee,{type:"text",name:"search",placeholder:"Search...",size:"small",autoComplete:"off",InputProps:{startAdornment:e.jsx(xe,{position:"start",children:e.jsx(ae,{fontSize:"small"})}),sx:{fontSize:"0.6em","& .MuiInputBase-input::placeholder":{fontSize:"1.25em"}}},sx:{minWidth:"16em"}}),e.jsx(A,{variant:"outlined",size:"small",color:"secondary",startIcon:e.jsx(ie,{fontSize:"small"}),sx:{textTransform:"none"},children:"Search by"}),e.jsx(A,{variant:"contained",startIcon:e.jsx(H,{fontSize:"small"}),size:"small",sx:{textTransform:"none"},onClick:s=>{v(n=>({...n,create:s.currentTarget}))},children:"New"})]})]}),e.jsx(pe,{anchorOrigin:{horizontal:"left",vertical:"bottom"},open:!!q,message:q,autoHideDuration:1500,onClose:J}),T.create&&e.jsx(re,{dataReferensi:{...m},anchorEl:T.create,setAnchorEl:v,menuOpen:F.create,setDataAction:C}),T.update&&e.jsx(oe,{dataReferensi:{...m},detailReferensiItem:S,anchorEl:T.update,setAnchorEl:v,menuOpen:F.update,setDataAction:C}),e.jsxs(he,{sx:{border:"1px solid "+d[300],borderRadius:"0.3em"},children:[e.jsxs(ge,{children:[e.jsx(fe,{children:e.jsxs(Y,{children:[e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:d[300]},children:e.jsx(R,{variant:"subtitle2",sx:{color:d[700]},children:l.selected[g]?"":"NO"})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:d[300]},children:e.jsx(R,{variant:"subtitle2",sx:{color:d[700]},children:"NAME"})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:d[300]},children:e.jsx(R,{variant:"subtitle2",sx:{color:d[700]},children:"KODE"})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:d[300]},children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:"0em 0.3em"},children:[e.jsx(R,{variant:"subtitle2",sx:{color:d[700]},children:"LEVEL"}),e.jsx(L,{size:"small",children:e.jsx(le,{fontSize:"small"})})]})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:d[300]},children:e.jsx(R,{variant:"subtitle2",sx:{color:d[700]},children:"ACTION"})})]})}),e.jsx(je,{children:o.slicedDataRef?o.slicedDataRef.length>0?o.slicedDataRef.map((s,n)=>{const a=`${s.nama}#${n}`;return e.jsxs(Y,{sx:{"&:hover":{backgroundColor:d[200]}},children:[e.jsx(j,{sx:{paddingY:"0.7em"},children:l.selected[g]?e.jsx(te,{size:"small",checked:i[a]??!1,value:s.id,onChange:W(a,g),sx:{padding:0}}):o.currentPage*5+(n+1)}),e.jsx(j,{sx:{paddingY:"0.7em"},children:s.nama}),e.jsx(j,{sx:{paddingY:"0.7em"},children:s.kode}),e.jsx(j,{sx:{paddingY:"0.7em"},children:"level tidak tersedia di API"}),e.jsx(j,{sx:{paddingY:"0.7em"},children:e.jsxs(u,{sx:{display:"flex"},children:[e.jsx(G,{title:"Ubah data",placement:"left-start",children:e.jsx(L,{size:"small",sx:{padding:"0.3em"},onClick:U({id:s.id,nama:s.nama,kode:s.kode}),children:e.jsx(ce,{fontSize:"small",sx:{color:se[700]}})})}),e.jsx(G,{title:"Delete",placement:"right-start",children:e.jsx(L,{size:"small",sx:{padding:"0.3em"},disabled:I[a],onClick:V(s.id,a),children:I[a]?e.jsx(M,{size:20,sx:{color:d[600]}}):e.jsx(de,{fontSize:"small"})})})]})})]},n)}):e.jsx(Y,{children:e.jsx(j,{size:"small",children:e.jsx(B,{severity:"warning",icon:e.jsx(w,{fontSize:"small",sx:{color:d[700]}}),sx:{fontSize:"small",backgroundColor:"transparent",fontWeight:550,fontStyle:"italic"},children:"No records found"})})}):e.jsx(ue,{})})]}),e.jsx(Se,{component:"div",count:x?x.length:0,onPageChange:(s,n)=>{Q(x,n)},page:o?o.currentPage:0,rowsPerPage:5,rowsPerPageOptions:[5,10]})]})]})}function be({indukReferensi:m,subReferensi:x,collapseFolder:f,collapseHandler:l}){const[p,S]=r.useState(null),[b,o]=r.useState(!1);return r.useEffect(()=>{(async i=>{const h=await E("https://spbe-malkot.onrender.com/api/v1/sub_refrensi/"+i+"/detail",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+z.get("authToken")}});S(h.data.Detail_Refrensi)})(x.id)},[b]),p?p.length>0?p.map((c,i)=>{const h=`${c.nama}#${c.kode}`;return e.jsxs(u,{children:[e.jsx(_,{folderLevel:"3",folderSxProps:{marginLeft:"6em",marginBottom:i===p.length-1?void 0:"0.5em",marginTop:i===0?void 0:"0.5em"},kodeReferensiArsitektur:"RAD.0"+c.kode,collapseState:f,collapseHandler:l,setDataAction:o,dataRef:c}),e.jsx(P,{in:f[h],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-lvl3-container",children:e.jsx(ke,{dataReferensi:{indukReferensi:m,subReferensi:x,detailReferensi:c}})})]},i)}):e.jsxs(B,{severity:"warning",icon:e.jsx(w,{fontSize:"small"}),sx:{marginX:"6em",marginY:"0.5em",fontSize:"small"},children:[e.jsx($,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx(K,{sxProps:{marginLeft:"6em"}})}function ye({indukReferensi:m,collapseFolder:x,collapseHandler:f}){const[l,p]=r.useState(null),[S,b]=r.useState(!1);return r.useEffect(()=>{(async c=>{const i=await E("https://spbe-malkot.onrender.com/api/v1/induk_refrensi/"+c+"/sub",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+z.get("authToken")}});p(i.data.Sub_Refrensi)})(m.id)},[S]),l?l.length>0?l.map((o,c)=>{const i=`${o.nama}#${o.kode}`;return e.jsxs(u,{children:[e.jsx(_,{folderLevel:"2",folderSxProps:{marginLeft:"3em",marginY:"0.5em"},kodeReferensiArsitektur:"RAD.0"+o.kode,collapseState:x,collapseHandler:f,setDataAction:b,dataRef:o}),e.jsx(P,{in:x[i],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-container",children:e.jsx(be,{indukReferensi:m,subReferensi:o,collapseFolder:x,collapseHandler:f})})]},c)}):e.jsxs(B,{severity:"warning",icon:e.jsx(w,{fontSize:"small"}),sx:{marginX:"3em",marginY:"0.5em",fontSize:"small"},children:[e.jsx($,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx(K,{sxProps:{marginLeft:"3em",marginTop:"0.5em"}})}function Ne(){const[m,x]=r.useState(null),[f,l]=r.useState({}),[p,S]=r.useState(!1),[b,o]=r.useState(!1),c=i=>()=>{l(h=>({...h,[i]:!h[i]}))};return r.useEffect(()=>{(async()=>{const h=await E("https://spbe-malkot.onrender.com/api/v1/refrensi_arsitektur/3/induk",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+z.get("authToken")}});x(h.data.Induk_Refrensi)})()},[p]),e.jsx(ne,{children:e.jsxs(u,{component:"div",className:"content-container",sx:{padding:"0.5em"},children:[e.jsxs(u,{component:"div",className:"referensi-arsitektur-layanan-container",children:[e.jsxs(u,{component:"div",className:"referensi-arsitektur-layanan-header",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingY:"0.5em"},children:[e.jsx(R,{variant:"subtitle2",sx:{fontSize:"1em",color:d[800]},children:"Referensi Arsitektur Data"}),e.jsx(A,{variant:"contained",startIcon:e.jsx(H,{sx:{fontSize:"small",color:"white"}}),size:"small",sx:{textTransform:"none"},onClick:()=>o(!0),children:"Induk Referensi"})]}),m?m.length>0?m.map((i,h)=>{const O=`${i.nama}#${i.kode}`;return e.jsxs(u,{children:[e.jsx(_,{folderLevel:"1",kodeReferensiArsitektur:"RAD.0"+i.kode,collapseState:f,collapseHandler:c,dataRef:i,setDataAction:S}),e.jsx(P,{in:f[O],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-container",children:e.jsx(ye,{collapseFolder:f,collapseHandler:c,indukReferensi:i})})]},h)}):e.jsxs(B,{severity:"warning",icon:e.jsx(w,{fontSize:"small"}),sx:{marginX:"3em",marginY:"0.5em",fontSize:"small"},children:[e.jsx($,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx(K,{})]}),e.jsx(me,{referensiArsitekturId:3,openDialog:b,setOpenDialog:o,setDataAction:S})]})})}export{Ne as default};
