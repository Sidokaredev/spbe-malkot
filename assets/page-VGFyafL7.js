import{J as r,j as e,B as x,T as R,a as d,Z as M,Y as ee,X as L,a5 as te,l as se,$ as E,a4 as P}from"./index-CpGWNxNa.js";import{T as G,a as ne}from"./DashboardAdminLayout-CN4Vh8VJ.js";import{a as ae,b as ie,A as H,d as I,I as w,F as A}from"./request-helpers-D0O3LUco.js";import{M as re,b as oe,I as le,E as ce,c as de,F as _,A as $,a as K,D as me}from"./MenuActionUpdate-ZUpRltUB.js";import{T as ue}from"./TableBodyReferensiPenggunaSkeleton-_n7aQFnH.js";import{B as C}from"./Button-DrUDL9uD.js";import{I as xe,S as pe}from"./arsitektur-bisnis-Bgs8Rp8F.js";import{T as he,a as fe,b as ge,c as je,d as Se}from"./TablePagination-DdxZtwmT.js";import{a as Y,T as j}from"./TableRow-CrAhGf4e.js";import"./Skeleton-FVbYjgpo.js";import"./dividerClasses-e0dSckBO.js";import"./useThemeProps-DBl1f4Ct.js";function ke({dataReferensi:m}){const[p,g]=r.useState(null),[l,h]=r.useState({selected:{},count:{},listSelectedKey:{}}),[S,b]=r.useState({id:0,nama:"",kode:0}),[o,c]=r.useState({slicedDataRef:null,currentPage:0}),[i,u]=r.useState({}),[O,D]=r.useState(!1),[T,v]=r.useState({create:null,update:null}),q={create:!!T.create,update:!!T.update},[F,z]=r.useState(""),[B,y]=r.useState({}),X=s=>()=>{h(n=>({...n,selected:{...n.selected,[s]:!n.selected[s]}}))},W=(s,n)=>a=>{u(t=>({...t,[s]:a.target.checked})),h(t=>{const k=t.count[n]??0,N=t.listSelectedKey[n]??[];return a.target.checked||N.pop(),{...t,count:{...t.count,[n]:a.target.checked?k+1:k-1},listSelectedKey:{...t.listSelectedKey,[n]:a.target.checked?[...N,Number(a.target.value)]:[...N]}}})},U=s=>n=>{v(a=>({...a,update:n.currentTarget})),b({id:s.id,nama:s.nama,kode:s.kode})},J=(s,n)=>{n!=="clickaway"&&z("")},V=(s,n)=>async()=>{y(t=>({...t,[n]:!0}));const a=await A("https://spbe-malkot.onrender.com/api/v1/refrensi_pengguna/"+s,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});if(!a.success)return y(t=>({...t,[n]:!1})),z("Gagal menghapus data");y(t=>({...t,[n]:!1})),z(a.data),D(t=>!t)},Z=s=>async()=>{y(t=>({...t,[s]:!0}));const n=l.listSelectedKey[s]??[];if(n.length===0)return y(t=>({...t,[s]:!1})),z("Pilih data terlebih dulu");const a=[];n.forEach(t=>{const k=A("https://spbe-malkot.onrender.com/api/v1/refrensi_pengguna/"+t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});a.push(k)});try{return await Promise.all(a),h(t=>({...t,count:{...t.count,[s]:0},listSelectedKey:{...t.listSelectedKey,[s]:[]}})),z("Data berhasil dihapus"),y(t=>({...t,[s]:!1})),D(t=>!t)}catch(t){if(y(k=>({...k,[s]:!1})),t instanceof Error)return z(t.message)}},Q=(s,n)=>{const a=(n+1-1)*5,t=a+5;c({slicedDataRef:s.slice(a,t),currentPage:n})};r.useEffect(()=>{(async n=>{const a=await A("https://spbe-malkot.onrender.com/api/v1/refrensi_detail/"+n+"/pengguna",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});console.log(a.data.Refrensi_Pengguna);const t=a.data.Refrensi_Pengguna;c(k=>({...k,slicedDataRef:t.slice(0,5)})),g(t)})(m.detailReferensi.id)},[O]);const f=`${m.detailReferensi.nama}#${m.detailReferensi.kode}`;return e.jsxs(x,{sx:{marginLeft:"9em",marginTop:"1em"},children:[e.jsxs(x,{component:"div",className:"table-filtering-panel",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"0.5em",marginBottom:"1em"},children:[e.jsxs(x,{sx:{display:"flex",gap:"1em"},children:[e.jsx(C,{variant:l.selected[f]?"contained":"text",size:"small",sx:{textTransform:"none"},onClick:X(f),color:l.selected[f]?"error":void 0,children:l.selected[f]?"Cancel":"Select items"}),l.selected[f]&&e.jsxs(x,{children:[e.jsx(R,{variant:"caption",sx:{marginX:"1em",fontWeight:"normal",cursor:"not-allowed",color:d[700]},children:`${l.count[f]??0} Selected`}),e.jsx(C,{color:"error",sx:{textTransform:"none"},disabled:B[f],onClick:Z(f),children:B[f]?e.jsx(M,{size:20,sx:{color:"red"}}):"Delete"})]})]}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:"0em 0.5em"},children:[e.jsx(ee,{type:"text",name:"search",placeholder:"Search...",size:"small",autoComplete:"off",InputProps:{startAdornment:e.jsx(xe,{position:"start",children:e.jsx(ae,{fontSize:"small"})}),sx:{fontSize:"0.6em","& .MuiInputBase-input::placeholder":{fontSize:"1.25em"}}},sx:{minWidth:"16em"}}),e.jsx(C,{variant:"outlined",size:"small",color:"secondary",startIcon:e.jsx(ie,{fontSize:"small"}),sx:{textTransform:"none"},children:"Search by"}),e.jsx(C,{variant:"contained",startIcon:e.jsx(H,{fontSize:"small"}),size:"small",sx:{textTransform:"none"},onClick:s=>{v(n=>({...n,create:s.currentTarget}))},children:"New"})]})]}),e.jsx(pe,{anchorOrigin:{horizontal:"left",vertical:"bottom"},open:!!F,message:F,autoHideDuration:1500,onClose:J}),T.create&&e.jsx(re,{dataReferensi:{...m},anchorEl:T.create,setAnchorEl:v,menuOpen:q.create,setDataAction:D}),T.update&&e.jsx(oe,{dataReferensi:{...m},detailReferensiItem:S,anchorEl:T.update,setAnchorEl:v,menuOpen:q.update,setDataAction:D}),e.jsxs(he,{sx:{border:"1px solid "+d[300],borderRadius:"0.3em"},children:[e.jsxs(fe,{children:[e.jsx(ge,{children:e.jsxs(Y,{children:[e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:d[300]},children:e.jsx(R,{variant:"subtitle2",sx:{color:d[700]},children:l.selected[f]?"":"NO"})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:d[300]},children:e.jsx(R,{variant:"subtitle2",sx:{color:d[700]},children:"NAME"})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:d[300]},children:e.jsx(R,{variant:"subtitle2",sx:{color:d[700]},children:"KODE"})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:d[300]},children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:"0em 0.3em"},children:[e.jsx(R,{variant:"subtitle2",sx:{color:d[700]},children:"LEVEL"}),e.jsx(L,{size:"small",children:e.jsx(le,{fontSize:"small"})})]})}),e.jsx(j,{sx:{paddingY:"0.7em",letterSpacing:"0.1em",backgroundColor:d[300]},children:e.jsx(R,{variant:"subtitle2",sx:{color:d[700]},children:"ACTION"})})]})}),e.jsx(je,{children:o.slicedDataRef?o.slicedDataRef.length>0?o.slicedDataRef.map((s,n)=>{const a=`${s.nama}#${n}`;return e.jsxs(Y,{sx:{"&:hover":{backgroundColor:d[200]}},children:[e.jsx(j,{sx:{paddingY:"0.7em"},children:l.selected[f]?e.jsx(te,{size:"small",checked:i[a]??!1,value:s.id,onChange:W(a,f),sx:{padding:0}}):o.currentPage*5+(n+1)}),e.jsx(j,{sx:{paddingY:"0.7em"},children:s.nama}),e.jsx(j,{sx:{paddingY:"0.7em"},children:s.kode}),e.jsx(j,{sx:{paddingY:"0.7em"},children:"level tidak tersedia di API"}),e.jsx(j,{sx:{paddingY:"0.7em"},children:e.jsxs(x,{sx:{display:"flex"},children:[e.jsx(G,{title:"Ubah data",placement:"left-start",children:e.jsx(L,{size:"small",sx:{padding:"0.3em"},onClick:U({id:s.id,nama:s.nama,kode:s.kode}),children:e.jsx(ce,{fontSize:"small",sx:{color:se[700]}})})}),e.jsx(G,{title:"Delete",placement:"right-start",children:e.jsx(L,{size:"small",sx:{padding:"0.3em"},disabled:B[a],onClick:V(s.id,a),children:B[a]?e.jsx(M,{size:20,sx:{color:d[600]}}):e.jsx(de,{fontSize:"small"})})})]})})]},n)}):e.jsx(Y,{children:e.jsx(j,{size:"small",children:e.jsx(I,{severity:"warning",icon:e.jsx(w,{fontSize:"small",sx:{color:d[700]}}),sx:{fontSize:"small",backgroundColor:"transparent",fontWeight:550,fontStyle:"italic"},children:"No records found"})})}):e.jsx(ue,{})})]}),e.jsx(Se,{component:"div",count:p?p.length:0,onPageChange:(s,n)=>{Q(p,n)},page:o?o.currentPage:0,rowsPerPage:5,rowsPerPageOptions:[5,10]})]})]})}function be({indukReferensi:m,subReferensi:p,collapseFolder:g,collapseHandler:l}){const[h,S]=r.useState(null),[b,o]=r.useState(!1);return r.useEffect(()=>{(async i=>{const u=await A("https://spbe-malkot.onrender.com/api/v1/sub_refrensi/"+i+"/detail",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});S(u.data.Detail_Refrensi)})(p.id)},[b]),h?h.length>0?h.map((c,i)=>{const u=`${c.nama}#${c.kode}`;return e.jsxs(x,{children:[e.jsx(_,{folderLevel:"3",folderSxProps:{marginLeft:"6em",marginBottom:i===h.length-1?void 0:"0.5em",marginTop:i===0?void 0:"0.5em"},kodeReferensiArsitektur:"RAB.0"+c.kode,collapseState:g,collapseHandler:l,setDataAction:o,dataRef:c}),e.jsx(P,{in:g[u],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-lvl3-container",children:e.jsx(ke,{dataReferensi:{indukReferensi:m,subReferensi:p,detailReferensi:c}})})]},i)}):e.jsxs(I,{severity:"warning",icon:e.jsx(w,{fontSize:"small"}),sx:{marginX:"6em",marginY:"0.5em",fontSize:"small"},children:[e.jsx($,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx(K,{sxProps:{marginLeft:"6em"}})}function ye({indukReferensi:m,collapseFolder:p,collapseHandler:g}){const[l,h]=r.useState(null),[S,b]=r.useState(!1);return r.useEffect(()=>{(async c=>{const i=await A("https://spbe-malkot.onrender.com/api/v1/induk_refrensi/"+c+"/sub",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});h(i.data.Sub_Refrensi)})(m.id)},[S]),l?l.length>0?l.map((o,c)=>{const i=`${o.nama}#${o.kode}`;return e.jsxs(x,{children:[e.jsx(_,{folderLevel:"2",folderSxProps:{marginLeft:"3em",marginY:"0.5em"},kodeReferensiArsitektur:"RAB.0"+o.kode,collapseState:p,collapseHandler:g,setDataAction:b,dataRef:o}),e.jsx(P,{in:p[i],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-container",children:e.jsx(be,{indukReferensi:m,subReferensi:o,collapseFolder:p,collapseHandler:g})})]},c)}):e.jsxs(I,{severity:"warning",icon:e.jsx(w,{fontSize:"small"}),sx:{marginX:"3em",marginY:"0.5em",fontSize:"small"},children:[e.jsx($,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx(K,{sxProps:{marginLeft:"3em",marginTop:"0.5em"}})}function Ne(){const[m,p]=r.useState(null),[g,l]=r.useState({}),[h,S]=r.useState(!1),[b,o]=r.useState(!1),c=i=>()=>{l(u=>({...u,[i]:!u[i]}))};return r.useEffect(()=>{(async()=>{const u=await A("https://spbe-malkot.onrender.com/api/v1/refrensi_arsitektur/1/induk",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+E.get("authToken")}});console.info("request 	:",u),p(u.data.Induk_Refrensi)})()},[h]),e.jsx(ne,{children:e.jsxs(x,{component:"div",className:"content-container",sx:{padding:"0.5em"},children:[e.jsxs(x,{component:"div",className:"referensi-arsitektur-layanan-container",children:[e.jsxs(x,{component:"div",className:"referensi-arsitektur-layanan-header",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingY:"0.5em"},children:[e.jsx(R,{variant:"subtitle2",sx:{fontSize:"1em",color:d[800]},children:"Referensi Arsitektur Bisnis"}),e.jsx(C,{variant:"contained",startIcon:e.jsx(H,{sx:{fontSize:"small",color:"white"}}),size:"small",sx:{textTransform:"none"},onClick:()=>o(!0),children:"Induk Referensi"})]}),m?m.length>0?m.map((i,u)=>{const O=`${i.nama}#${i.kode}`;return e.jsxs(x,{children:[e.jsx(_,{folderLevel:"1",kodeReferensiArsitektur:"RAB.0"+i.kode,collapseState:g,collapseHandler:c,dataRef:i,setDataAction:S}),e.jsx(P,{in:g[O],mountOnEnter:!0,unmountOnExit:!0,component:"div",className:"sub-ref-container",children:e.jsx(ye,{collapseFolder:g,collapseHandler:c,indukReferensi:i})})]},u)}):e.jsxs(I,{severity:"warning",icon:e.jsx(w,{fontSize:"small"}),sx:{marginX:"3em",marginY:"0.5em",fontSize:"small"},children:[e.jsx($,{fontSize:"small",children:"Empty"}),"No data available at the moment."]}):e.jsx(K,{})]}),e.jsx(me,{referensiArsitekturId:1,openDialog:b,setOpenDialog:o,setDataAction:S})]})})}export{Ne as default};
